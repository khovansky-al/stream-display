<!DOCTYPE html>
<html lang="en">

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta charset="utf-8" />

  <title>Demo</title>
  <style>
    :root {
      font-family: OpenSans, sans-serif;
    }

    .wrapper {
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    video, canvas {
      display: none;
    }

    .actions {
      margin-top: 1rem;
    }
  </style>
</head>

<body>
  <div class="wrapper">
    <h1>Live QR Scanner</h1>

    <div class="status">
      Status: <span>inactive</span>
    </div>
    <div class="result">
    </div>

    <div class="actions">
      <button id="start">Start scanning</button>
      <button id="stop" disabled>Stop scanning</button>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/jsqr@1.2.0/dist/jsQR.min.js"></script>
  <script src="./dist/index.min.js"></script>
  <script>
    const resultValue = document.querySelector('.result')

    const startButton = document.getElementById('start');
    const stopButton = document.getElementById('stop');
    let capture;

    document.addEventListener('DOMContentLoaded', () => {
      capture = new StreamDisplay(scanVideoStream.bind(this));

      startButton.addEventListener('click', () => {
        startCapture();
      });

      stopButton.addEventListener('click', () => {
        stopCapture();
      });
    })

    async function startCapture() {
      try {
        await capture.startCapture();

        startButton.disabled = true;
        stopButton.disabled = false;

        setResult();
      } catch (err) {
        console.error("Error: " + err);
      }
    }

    function stopCapture() {
      stopButton.disabled = true;
      startButton.disabled = false;

      capture.stopCapture();
    }

    function scanVideoStream(imageData) {
      const code = jsQR(imageData.data, imageData.width, imageData.height);

      if (code) {
        console.log("Found QR code", code);
        setResult(code.data);

        return stopCapture();
      }
    }

    function setResult(result) {
      if (typeof result !== 'string') {
        resultValue.innerText = '';
        return;
      }

      resultValue.innerText = `Result: ${result}`;
    }
  </script>
</body>

</html>
